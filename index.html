<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æ¥µé€Ÿæˆ°æƒ…å®¤ v4.0 (OP Power)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    :root { --bg:#000; --card:#1c1c1e; --text:#fff; --red:#ff453a; --green:#30d158; --blue:#0a84ff; }
    body { background:var(--bg); color:var(--text); font-family:-apple-system, sans-serif; padding:15px; margin:0; overflow-y:auto; }
    .dashboard-container { filter: blur(10px); transition: filter 0.5s; pointer-events: none; }
    .unlocked { filter: blur(0); pointer-events: auto; }
    
    /* ä¸Šæ–¹å€å¡Š (ç¶­æŒåŸæ¨£) */
    .top-section { display:grid; grid-template-columns:1fr 1.3fr; gap:12px; margin-bottom:12px; }
    
    /* [NEW] OP åŠ›é“å°ˆç”¨æ¨£å¼ */
    .op-section { margin-bottom: 15px; }
    .op-row { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-top: 5px; }
    .op-col { display: flex; flex-direction: column; }
    .op-val { font-size: 26px; font-weight: 700; }
    .total-power { font-size: 52px; font-weight: 800; text-align: center; margin: 5px 0; line-height: 1; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
    .divider { height: 1px; background: #333; width: 100%; margin: 15px 0; }

    .box { background:var(--card); border-radius:18px; padding:16px; display:flex; flex-direction:column; justify-content:space-between; border: 1px solid #333; }
    .big-val { font-size:32px; font-weight:600; letter-spacing:-1px; margin-top:5px; }
    .power-val { font-size:38px; font-weight:700; text-align:right; }
    .chip-tag { font-size:11px; padding:3px 8px; border-radius:6px; width:fit-content; background:#333; color:#ccc; }
    
    /* æˆ°è¡“æŒ‡ä»¤æ–‡å­— */
    .logic-box { background: #2c2c2e; border-radius: 18px; padding: 15px; margin-bottom: 15px; border: 2px solid #444; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .logic-text { font-size: 18px; font-weight: 700; color: #fff; line-height: 1.4; text-align: center; }

    .chip-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .chip-card { background:var(--card); padding:12px; border-radius:14px; display:flex; flex-direction:column; }
    .label { font-size:12px; color:#8e8e93; font-weight:600; text-transform:uppercase; }
    
    .c-red { color:var(--red); } .c-green { color:var(--green); }
    .bg-red { background:rgba(255, 69, 58, 0.15); color:var(--red); } 
    .bg-green { background:rgba(48, 209, 88, 0.15); color:var(--green); }
    
    /* ç™»å…¥é®ç½© */
    #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s; }
    .login-box { text-align: center; width: 80%; max-width: 300px; }
    input[type="password"] { width: 100%; padding: 12px; border-radius: 10px; border: none; background: #1c1c1e; color: #fff; font-size: 18px; text-align: center; margin-bottom: 15px; outline: none; }
    button { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--blue); color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; }
    .error-msg { color: var(--red); font-size: 14px; margin-top: 10px; min-height: 20px; }

    /* å‘¼å¸ç‡ˆç‰¹æ•ˆ */
    @keyframes pulse-red { 0%{box-shadow:0 0 0 0 rgba(255,69,58,0.4)} 70%{box-shadow:0 0 0 10px rgba(255,69,58,0)} 100%{box-shadow:0 0 0 0} }
    @keyframes pulse-green { 0%{box-shadow:0 0 0 0 rgba(48,209,88,0.4)} 70%{box-shadow:0 0 0 10px rgba(48,209,88,0)} 100%{box-shadow:0 0 0 0} }
    .alert-red { animation:pulse-red 2s infinite; border:1px solid var(--red)!important; background:rgba(255,69,58,0.2)!important; }
    .alert-green { animation:pulse-green 2s infinite; border:1px solid var(--green)!important; background:rgba(48,209,88,0.2)!important; }
  </style>
</head>
<body>
  <div id="login-overlay">
    <div class="login-box">
      <div style="font-size:20px; margin-bottom:20px; color:#fff; font-weight:600;">ğŸ”’ æˆ°æƒ…å®¤ç™»å…¥</div>
      <input type="password" id="pass-input" placeholder="å¯†ç¢¼" pattern="[0-9]*" inputmode="numeric">
      <button onclick="checkPass()">é€²å…¥ç›£æ§</button>
      <div class="error-msg" id="error-msg"></div>
    </div>
  </div>

  <div class="dashboard-container" id="dashboard">
    
    <div class="top-section">
      <div class="box">
        <div class="label">TX å°æŒ‡æœŸ</div>
        <div id="price" class="big-val">---</div>
        <div id="status-text" class="label" style="margin-top:5px; color:#aaa">å¾…å‘½ä¸­...</div>
      </div>
      <div class="box" style="text-align:right" id="pwr-box">
        <div class="label">ğŸš€ P6 è²·æ–¹å‹•èƒ½</div>
        <div id="pwr-val" class="power-val">0%</div>
        <div id="pwr-tag" class="chip-tag" style="align-self: flex-end;">Wait</div>
      </div>
    </div>

    <div class="op-section">
        <div class="box" id="chip-box" style="align-items: center;">
            <div class="label" style="margin-bottom:5px;">ğŸš€ OP ç¸½åŠ›é“å·® (P7)</div>
            <div id="total-val" class="total-power">--</div>
            
            <div class="divider"></div>
            
            <div class="op-row">
                <div class="op-col" style="align-items: flex-start;">
                    <div class="label" style="color:#ff453a;">ğŸ”´ CALL åŠ›é“</div>
                    <div id="call-val" class="op-val" style="color:#ff453a;">--</div>
                </div>
                <div class="op-col" style="align-items: flex-end;">
                    <div class="label" style="color:#30d158;">ğŸŸ¢ PUT åŠ›é“</div>
                    <div id="put-val" class="op-val" style="color:#30d158;">--</div>
                </div>
            </div>
        </div>
    </div>

    <div class="logic-box" id="logic-box">
        <div class="label" style="margin-bottom:8px;">ğŸ’¡ æˆ°è¡“æŒ‡ä»¤</div>
        <div id="logic-text" class="logic-text">åˆ†æä¸­...</div>
    </div>

    <div class="label" style="margin-bottom:8px">ğŸ“Š ç±Œç¢¼åˆ†ä½ˆ (E5~E8)</div>
    <div class="chip-grid">
      <div class="chip-card" id="c1-card"><span class="label">è¿‘ å…¨æ—¥</span><span id="c1-val" class="big-val" style="font-size:20px">--</span><span id="c1-tag" class="chip-tag">--</span></div>
      <div class="chip-card" id="c2-card"><span class="label">è¿‘ æ—¥ç›¤</span><span id="c2-val" class="big-val" style="font-size:20px">--</span><span id="c2-tag" class="chip-tag">--</span></div>
      <div class="chip-card" id="c3-card"><span class="label">æ¬¡ å…¨æ—¥</span><span id="c3-val" class="big-val" style="font-size:20px">--</span><span id="c3-tag" class="chip-tag">--</span></div>
      <div class="chip-card" id="c4-card"><span class="label">æ¬¡ æ—¥ç›¤</span><span id="c4-val" class="big-val" style="font-size:20px">--</span><span id="c4-tag" class="chip-tag">--</span></div>
    </div>
    
    <div style="text-align:center; font-size:11px; color:#444; margin-top:20px" id="update-time">--:--</div>
  </div>

  <script>
    // â˜…â˜…â˜… è¨­å®šå€ â˜…â˜…â˜…
    const MY_PASSWORD = "168"; 
    // è«‹ç¢ºèªé€™è£¡æ˜¯æ‚¨çš„ Firebase ç¶²å€
    const FIREBASE_URL = "https://tx-monitor-93eb2-default-rtdb.asia-southeast1.firebasedatabase.app/"; 

    function checkPass() {
      if (document.getElementById('pass-input').value === MY_PASSWORD) {
        document.getElementById('login-overlay').style.opacity = '0';
        setTimeout(() => { 
          document.getElementById('login-overlay').style.display = 'none'; 
          document.getElementById('dashboard').classList.add('unlocked');
        }, 500);
        initFirebase();
      } else {
        document.getElementById('error-msg').innerText = "å¯†ç¢¼éŒ¯èª¤";
        document.getElementById('pass-input').value = "";
      }
    }

    function initFirebase() {
      if (!firebase.apps.length) firebase.initializeApp({ databaseURL: FIREBASE_URL });
      firebase.database().ref('monitor').on('value', (s) => {
        if (s.val()) updateUI(s.val());
      });
    }

    function updateUI(data) {
      // 1. åŸºç¤è³‡è¨Š
      document.getElementById('price').innerText = data.p;
      document.getElementById('update-time').innerText = "Update: " + data.t;
      document.getElementById('status-text').innerText = data.st;

      // 2. P6 å‹•èƒ½ (åŸåŠŸèƒ½)
      let pVal = parseFloat(data.pwr_v);
      let pEl = document.getElementById('pwr-val');
      let pTag = document.getElementById('pwr-tag');
      
      pEl.innerText = data.pwr_t;
      pEl.className = "power-val " + (pVal > 0 ? "c-red" : (pVal < 0 ? "c-green" : ""));
      
      pTag.className = "chip-tag"; pTag.style = "";
      if (pVal > 50) { pTag.className += " bg-red alert-red"; pTag.innerText = "æ¥µç«¯å¤šé ­"; }
      else if (pVal >= 30) { pTag.className += " bg-red"; pTag.innerText = "å¼·å‹¢å¤šé ­"; }
      else if (pVal <= -50) { pTag.className += " bg-green alert-green"; pTag.innerText = "æ¥µç«¯å´©è·Œ"; }
      else if (pVal <= -30) { pTag.className += " bg-green"; pTag.innerText = "å¼·å‹¢ç©ºé ­"; }
      else { pTag.innerText = "éœ‡ç›ªç›¤æ•´"; }

      // 3. [NEW] OP åŠ›é“æ‹†è§£ (Call / Total / Put)
      let total = data.chip_p7 || 0;
      let callPwr = data.call_pwr || 0;
      let putPwr = data.put_pwr || 0;

      // æ›´æ–°ç¸½åŠ›é“ (P7)
      let tEl = document.getElementById('total-val');
      let tBox = document.getElementById('chip-box');
      tEl.innerText = (total > 0 ? "+" : "") + total;
      tEl.className = "total-power " + (total > 0 ? "c-red" : (total < 0 ? "c-green" : ""));

      // ç¸½åŠ›é“éå¤§æ™‚ç™¼å…‰
      tBox.className = "box"; // Reset
      if (Math.abs(total) >= 100) {
          tBox.classList.add(total > 0 ? "alert-red" : "alert-green");
      }

      // æ›´æ–° Call åŠ›é“
      let cEl = document.getElementById('call-val');
      cEl.innerText = (callPwr > 0 ? "+" : "") + callPwr;
      cEl.style.color = callPwr > 0 ? "var(--red)" : (callPwr < 0 ? "var(--green)" : "#888");

      // æ›´æ–° Put åŠ›é“
      let pEl2 = document.getElementById('put-val');
      pEl2.innerText = (putPwr > 0 ? "+" : "") + putPwr;
      pEl2.style.color = putPwr > 0 ? "var(--red)" : (putPwr < 0 ? "var(--green)" : "#888");

      // 4. æˆ°è¡“æŒ‡ä»¤
      let logicText = data.logic || "âšª ç­‰å¾…è¨Šè™Ÿ...";
      let logicEl = document.getElementById('logic-text');
      let logicBox = document.getElementById('logic-box');
      
      logicEl.innerText = logicText;
      logicBox.className = "logic-box"; // Reset
      
      if (logicText.includes("åŠ©æ¼²") || logicText.includes("èª˜ç©º")) {
          logicBox.classList.add("alert-red");
      } else if (logicText.includes("åŠ©è·Œ") || logicText.includes("èª˜å¤š")) {
          logicBox.classList.add("alert-green");
      }

      // 5. C1~C4 ç±Œç¢¼åˆ†ä½ˆ (åŸåŠŸèƒ½)
      ['c1','c2','c3','c4'].forEach(id => {
        let raw = data[id]; if(!raw) return;
        let parts = raw.split('|');
        let v = parseFloat(parts[0].replace('%',''));
        let el = document.getElementById(id+'-val');
        el.innerText = parts[0]; el.className = "big-val " + (v>0?"c-red":(v<0?"c-green":"")); el.style.fontSize = "20px";
        let tag = document.getElementById(id+'-tag');
        tag.innerText = parts[1]; tag.className = "chip-tag " + (parts[1].includes("å¤š")?"bg-red":(parts[1].includes("ç©º")?"bg-green":""));
        let card = document.getElementById(id+'-card');
        if(parts[1].includes("å¼·")) card.style.border = v>0?"1px solid rgba(255,69,58,0.3)":"1px solid rgba(48,209,88,0.3)";
        else card.style.border = "none";
      });
    }
  </script>
</body>
</html>
