<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æ¥µé€Ÿæˆ°æƒ…å®¤ v2.0 (Live)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    :root { --bg:#000; --card:#1c1c1e; --text:#fff; --red:#ff453a; --green:#30d158; --blue:#0a84ff; --gray:#8e8e93; }
    body { background:var(--bg); color:var(--text); font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding:20px; margin:0; overflow:hidden; }
    
    /* æ¨¡ç³Šé–å®šæ•ˆæœ */
    .dashboard-container { filter: blur(15px); transition: filter 0.6s cubic-bezier(0.16, 1, 0.3, 1); pointer-events: none; opacity: 0.5; }
    .unlocked { filter: blur(0); pointer-events: auto; opacity: 1; }

    /* ç‰ˆé¢é…ç½® */
    .header-section { text-align: center; margin-bottom: 25px; }
    .price-display { font-size: 56px; font-weight: 800; letter-spacing: -1px; margin: 10px 0; text-shadow: 0 0 20px rgba(255,255,255,0.1); }
    
    .grid-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    
    .box { background:var(--card); border-radius:20px; padding:20px; display:flex; flex-direction:column; align-items: center; justify-content:center; box-shadow: 0 4px 20px rgba(0,0,0,0.5); border: 1px solid #333; transition: all 0.3s; }
    
    .label { font-size:13px; color:var(--gray); font-weight:600; text-transform:uppercase; margin-bottom: 5px; letter-spacing: 1px; }
    .val-text { font-size:32px; font-weight:700; letter-spacing:-0.5px; }
    
    /* æˆ°è¡“æŒ‡ä»¤å€å¡Š */
    .logic-box { 
        background: #2c2c2e; 
        border-radius: 20px; 
        padding: 25px; 
        text-align: center; 
        margin-top: 10px;
        border: 2px solid #444;
        transition: all 0.5s ease;
    }
    .logic-text { font-size: 24px; font-weight: bold; color: #fff; }

    /* é¡è‰²èˆ‡ç‹€æ…‹é¡åˆ¥ */
    .c-red { color:var(--red); } 
    .c-green { color:var(--green); }
    .c-neutral { color: #fff; }

    /* èƒŒæ™¯å‘¼å¸ç‡ˆç‰¹æ•ˆ */
    @keyframes pulse-red-bg { 0%{background-color: rgba(255, 69, 58, 0.1); border-color: var(--red);} 50%{background-color: rgba(255, 69, 58, 0.25); border-color: #ff8882;} 100%{background-color: rgba(255, 69, 58, 0.1); border-color: var(--red);} }
    @keyframes pulse-green-bg { 0%{background-color: rgba(48, 209, 88, 0.1); border-color: var(--green);} 50%{background-color: rgba(48, 209, 88, 0.25); border-color: #80ff9e;} 100%{background-color: rgba(48, 209, 88, 0.1); border-color: var(--green);} }
    
    .alert-bg-red { animation: pulse-red-bg 1.5s infinite; }
    .alert-bg-green { animation: pulse-green-bg 1.5s infinite; }

    /* ç™»å…¥é®ç½© */
    #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s; }
    .login-box { text-align: center; width: 80%; max-width: 300px; }
    input[type="password"] { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #333; background: #1c1c1e; color: #fff; font-size: 20px; text-align: center; margin-bottom: 20px; outline: none; box-sizing: border-box; }
    button { width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--blue); color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; transition: opacity 0.2s; }
    button:active { opacity: 0.7; }
    .error-msg { color: var(--red); font-size: 14px; margin-top: 15px; min-height: 20px; }

  </style>
</head>
<body>
  
  <div id="login-overlay">
    <div class="login-box">
      <div style="font-size:40px; margin-bottom:20px;">ğŸ”’</div>
      <div style="font-size:22px; margin-bottom:30px; color:#fff; font-weight:700;">æˆ°æƒ…å®¤ç™»å…¥</div>
      <input type="password" id="pass-input" placeholder="Enter Password" pattern="[0-9]*" inputmode="numeric">
      <button onclick="checkPass()">Access Dashboard</button>
      <div class="error-msg" id="error-msg"></div>
    </div>
  </div>

  <div class="dashboard-container" id="dashboard">
    
    <div class="header-section">
      <div class="label">TX å°æŒ‡æœŸç¾åƒ¹</div>
      <div id="price" class="price-display">---</div>
      <div id="update-time" style="font-size:12px; color:#666; font-family:monospace;">Waiting for signal...</div>
    </div>

    <div class="grid-row">
      <div class="box" id="pwr-box">
        <div class="label">ğŸš€ å‹•èƒ½ (P6)</div>
        <div id="pwr-val" class="val-text">--%</div>
      </div>
      
      <div class="box" id="chip-box">
        <div class="label">ğŸ›¡ï¸ ç±Œç¢¼ (P7)</div>
        <div id="chip-val" class="val-text">--</div>
      </div>
    </div>

    <div class="logic-box" id="logic-card">
      <div class="label" style="color:#aaa; margin-bottom:10px;">TACTICAL SIGNAL</div>
      <div id="logic-text" class="logic-text">åˆ†æä¸­...</div>
    </div>

  </div>

  <script>
    // â˜…â˜…â˜… è¨­å®šå€ â˜…â˜…â˜…
    const MY_PASSWORD = "168"; 
    // è«‹ç¢ºèªæ­¤è™•ç‚ºæ‚¨çš„ Firebase URL
    const FIREBASE_URL = "https://tx-monitor-93eb2-default-rtdb.asia-southeast1.firebasedatabase.app/"; 

    function checkPass() {
      if (document.getElementById('pass-input').value === MY_PASSWORD) {
        document.getElementById('login-overlay').style.opacity = '0';
        setTimeout(() => { 
          document.getElementById('login-overlay').style.display = 'none'; 
          document.getElementById('dashboard').classList.add('unlocked');
        }, 500);
        initFirebase();
      } else {
        document.getElementById('error-msg').innerText = "å¯†ç¢¼éŒ¯èª¤ / Invalid Password";
        document.getElementById('pass-input').value = "";
        document.getElementById('pass-input').focus();
      }
    }

    function initFirebase() {
      if (!firebase.apps.length) firebase.initializeApp({ databaseURL: FIREBASE_URL });
      firebase.database().ref('monitor').on('value', (s) => {
        if (s.val()) updateUI(s.val());
      });
    }

    function updateUI(data) {
      // 1. åƒ¹æ ¼èˆ‡æ™‚é–“
      document.getElementById('price').innerText = data.p;
      document.getElementById('update-time').innerText = "Last Update: " + data.t;

      // 2. å‹•èƒ½ (P6) è™•ç†
      let pVal = parseFloat(data.pwr_v);
      let pEl = document.getElementById('pwr-val');
      let pBox = document.getElementById('pwr-box');
      
      pEl.innerText = data.pwr_t; // é¡¯ç¤º +25.5%
      pEl.className = "val-text " + (pVal > 0 ? "c-red" : (pVal < 0 ? "c-green" : "c-neutral"));
      
      // å‹•èƒ½éå¤§æ™‚ï¼Œæ ¼å­ç™¼å…‰
      if (Math.abs(pVal) >= 20) {
          pBox.style.border = pVal > 0 ? "1px solid var(--red)" : "1px solid var(--green)";
      } else {
          pBox.style.border = "1px solid #333";
      }

      // 3. ç±Œç¢¼ (P7) è™•ç† [NEW]
      let chipVal = data.chip_p7;
      if (chipVal === undefined) chipVal = 0; // é˜²æ­¢èˆŠè³‡æ–™å ±éŒ¯
      
      let cEl = document.getElementById('chip-val');
      cEl.innerText = (chipVal > 0 ? "+" : "") + chipVal;
      cEl.className = "val-text " + (chipVal > 0 ? "c-red" : (chipVal < 0 ? "c-green" : "c-neutral"));

      // 4. æˆ°è¡“æŒ‡ä»¤ (Logic) è™•ç† [NEW]
      let logicText = data.logic || "âšª ç­‰å¾…è¨Šè™Ÿ...";
      let lEl = document.getElementById('logic-text');
      let lCard = document.getElementById('logic-card');
      
      lEl.innerText = logicText;
      
      // ç§»é™¤èˆŠå‹•ç•«
      lCard.classList.remove('alert-bg-red', 'alert-bg-green');
      
      // æ ¹æ“šæŒ‡ä»¤é—œéµå­—è®Šè‰²èˆ‡å‹•ç•«
      if (logicText.includes("åŠ©æ¼²") || logicText.includes("èª˜ç©º")) {
          // å¤šæ–¹æœ‰åˆ© (çœŸçªç ´ or èª˜ç©ºVè½‰) -> ç´…è‰²è­¦æˆ’
          lCard.classList.add('alert-bg-red');
          lCard.style.borderColor = "var(--red)";
      } else if (logicText.includes("åŠ©è·Œ") || logicText.includes("èª˜å¤š")) {
          // ç©ºæ–¹æœ‰åˆ© (çœŸè·Œç ´ or èª˜å¤šå›æª”) -> ç¶ è‰²è­¦æˆ’
          lCard.classList.add('alert-bg-green');
          lCard.style.borderColor = "var(--green)";
      } else {
          // ç›¤æ•´
          lCard.style.background = "#2c2c2e";
          lCard.style.borderColor = "#444";
      }
    }
  </script>
</body>
</html>
