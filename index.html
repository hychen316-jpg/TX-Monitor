<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æ¥µé€Ÿæˆ°æƒ…å®¤ v9.0 (Dominance)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    :root { --bg:#000; --card:#1c1c1e; --text:#fff; --red:#ff453a; --green:#32d74b; --blue:#0a84ff; }
    body { background:var(--bg); color:var(--text); font-family:-apple-system, sans-serif; padding:15px; margin:0; overflow-y:auto; }
    .dashboard-container { filter: blur(10px); transition: filter 0.5s; pointer-events: none; }
    .unlocked { filter: blur(0); pointer-events: auto; }
    
    .top-section { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:15px; }

    /* æ‹”æ²³æˆ°å ´ */
    .battle-box { background: #2c2c2e; border-radius: 20px; padding: 20px; margin-bottom: 20px; border: 2px solid #444; position: relative; overflow: hidden; }
    
    .battle-title { text-align: center; color: #aaa; font-size: 12px; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
    
    /* å·¨å¤§çš„æ‹”æ²³æ¢ */
    .tug-container { height: 44px; background: #111; border-radius: 22px; position: relative; overflow: hidden; display: flex; box-shadow: inset 0 2px 8px rgba(0,0,0,0.6); }
    
    .bull-bar { height: 100%; background: var(--red); transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1); display: flex; align-items: center; justify-content: flex-end; padding-right: 12px; min-width: 15%; }
    .bear-bar { height: 100%; background: var(--green); transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1); display: flex; align-items: center; padding-left: 12px; min-width: 15%; }
    
    .percent-text { font-size: 18px; font-weight: 800; color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.6); white-space: nowrap; }

    /* é›™æ–¹è»åŠ›æ•¸å€¼ */
    .army-stats { display: flex; justify-content: space-between; margin-top: 15px; font-size: 14px; }
    .bull-val { color: var(--red); font-weight: bold; }
    .bear-val { color: var(--green); font-weight: bold; }

    .logic-text { text-align: center; font-size: 22px; font-weight: 800; margin-top: 20px; text-shadow: 0 0 10px rgba(0,0,0,0.8); letter-spacing: 1px; }

    .box { background:var(--card); border-radius:18px; padding:16px; display:flex; flex-direction:column; justify-content:center; align-items: center; border: 1px solid #333; }
    .chip-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .chip-card { background:var(--card); padding:12px; border-radius:14px; display:flex; flex-direction:column; }
    .big-val { font-size:32px; font-weight:600; letter-spacing:-1px; }
    .label { font-size:12px; color:#8e8e93; font-weight:600; text-transform:uppercase; margin-bottom: 5px; }
    .chip-tag { font-size:11px; padding:3px 8px; border-radius:6px; background:#333; color:#ccc; width: fit-content; }
    
    .c-red { color:var(--red); } .c-green { color:var(--green); }
    
    #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .login-box { text-align: center; width: 80%; max-width: 300px; }
    input[type="password"] { width: 100%; padding: 12px; border-radius: 10px; border: none; background: #1c1c1e; color: #fff; font-size: 18px; text-align: center; margin-bottom: 15px; outline: none; }
    button { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--blue); color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; }
    .error-msg { color: var(--red); font-size: 14px; margin-top: 10px; min-height: 20px; }

    /* å‘¼å¸ç‡ˆç‰¹æ•ˆ */
    .glow-red { box-shadow: 0 0 25px rgba(255, 69, 58, 0.3); border-color: var(--red); animation: pulse-red 2s infinite; }
    .glow-green { box-shadow: 0 0 25px rgba(50, 215, 75, 0.3); border-color: var(--green); animation: pulse-green 2s infinite; }
    @keyframes pulse-red { 0%{box-shadow:0 0 0 0 rgba(255,69,58,0.3)} 70%{box-shadow:0 0 0 15px rgba(255,69,58,0)} 100%{box-shadow:0 0 0 0} }
    @keyframes pulse-green { 0%{box-shadow:0 0 0 0 rgba(50,215,75,0.3)} 70%{box-shadow:0 0 0 15px rgba(50,215,75,0)} 100%{box-shadow:0 0 0 0} }
  </style>
</head>
<body>
  <div id="login-overlay">
    <div class="login-box">
      <div style="font-size:20px; margin-bottom:20px; color:#fff; font-weight:600;">ğŸ”’ æˆ°æƒ…å®¤ç™»å…¥</div>
      <input type="password" id="pass-input" placeholder="å¯†ç¢¼" pattern="[0-9]*" inputmode="numeric">
      <button onclick="checkPass()">é€²å…¥ç›£æ§</button>
      <div class="error-msg" id="error-msg"></div>
    </div>
  </div>

  <div class="dashboard-container" id="dashboard">
    <div class="top-section" style="display:block; text-align:center; margin-bottom:20px;">
      <div class="label">TX å°æŒ‡æœŸç¾åƒ¹</div>
      <div id="price" style="font-size:52px; font-weight:800; color:#fff;">---</div>
      <div id="update-time" style="font-size:12px; color:#666; font-family:monospace;">--:--:--</div>
    </div>

    <div class="battle-box" id="battle-card">
        <div class="battle-title">OP MARKET DOMINANCE (å¤šç©ºä½”æ¯”)</div>
        
        <div class="tug-container">
            <div id="bull-bar" class="bull-bar" style="width: 50%;">
                <span id="bull-pct" class="percent-text" style="opacity:0.5;">50%</span>
            </div>
            <div id="bear-bar" class="bear-bar" style="width: 50%;">
                <span id="bear-pct" class="percent-text" style="opacity:0.5;">50%</span>
            </div>
        </div>

        <div class="army-stats">
            <div>ğŸ”´ å¤šæ–¹è»åŠ›: <span id="bull-force" class="bull-val">--</span></div>
            <div>ğŸŸ¢ ç©ºæ–¹è»åŠ›: <span id="bear-force" class="bear-val">--</span></div>
        </div>

        <div id="logic-text" class="logic-text">ç­‰å¾…æ•¸æ“š...</div>
    </div>

    <div class="label" style="margin-bottom:8px">ğŸ“Š ç±Œç¢¼åˆ†ä½ˆ</div>
    <div class="chip-grid">
      <div class="chip-card" id="c1-card"><span class="label">è¿‘ å…¨æ—¥</span><span id="c1-val" class="big-val" style="font-size:20px">--</span><span id="c1-tag" class="chip-tag">--</span></div>
      <div class="chip-card" id="c2-card"><span class="label">è¿‘ æ—¥ç›¤</span><span id="c2-val" class="big-val" style="font-size:20px">--</span><span id="c2-tag" class="chip-tag">--</span></div>
      <div class="chip-card" id="c3-card"><span class="label">æ¬¡ å…¨æ—¥</span><span id="c3-val" class="big-val" style="font-size:20px">--</span><span id="c3-tag" class="chip-tag">--</span></div>
      <div class="chip-card" id="c4-card"><span class="label">æ¬¡ æ—¥ç›¤</span><span id="c4-val" class="big-val" style="font-size:20px">--</span><span id="c4-tag" class="chip-tag">--</span></div>
    </div>
  </div>

  <script>
    const MY_PASSWORD = "168"; 
    const FIREBASE_URL = "https://tx-monitor-93eb2-default-rtdb.asia-southeast1.firebasedatabase.app/"; 

    function checkPass() {
      if (document.getElementById('pass-input').value === MY_PASSWORD) {
        document.getElementById('login-overlay').style.opacity = '0';
        setTimeout(() => { 
          document.getElementById('login-overlay').style.display = 'none'; 
          document.getElementById('dashboard').classList.add('unlocked');
        }, 500);
        initFirebase();
      } else {
        document.getElementById('error-msg').innerText = "å¯†ç¢¼éŒ¯èª¤";
        document.getElementById('pass-input').value = "";
      }
    }

    function initFirebase() {
      if (!firebase.apps.length) firebase.initializeApp({ databaseURL: FIREBASE_URL });
      firebase.database().ref('monitor').on('value', (s) => {
        if (s.val()) updateUI(s.val());
      });
    }

    function updateUI(data) {
      document.getElementById('price').innerText = data.p;
      document.getElementById('update-time').innerText = "Update: " + data.t;

      // 1. è®€å–æ‹”æ²³æ•¸æ“š
      let bullF = parseFloat(data.bull_f || 0);
      let bearF = parseFloat(data.bear_f || 0);
      let bullR = parseFloat(data.bull_r || 50); // å¤šæ–¹ä½”æ¯” %
      let bearR = 100 - bullR;                   // ç©ºæ–¹ä½”æ¯” %

      // æ›´æ–°è»åŠ›æ•¸å€¼
      document.getElementById('bull-force').innerText = bullF;
      document.getElementById('bear-force').innerText = bearF;

      // æ›´æ–°æ‹”æ²³æ¢ (Width)
      let bBar = document.getElementById('bull-bar');
      let rBar = document.getElementById('bear-bar');
      
      bBar.style.width = bullR + "%";
      rBar.style.width = bearR + "%";

      // æ›´æ–°ç™¾åˆ†æ¯”æ–‡å­— (å­—é«”é€æ˜åº¦èª¿æ•´ï¼Œå¤ªå°å°±ä¸é¡¯ç¤º)
      let bTxt = document.getElementById('bull-pct');
      let rTxt = document.getElementById('bear-pct');
      
      bTxt.innerText = Math.round(bullR) + "%";
      rTxt.innerText = Math.round(bearR) + "%";
      
      bTxt.style.opacity = bullR > 20 ? 1 : 0;
      rTxt.style.opacity = bearR > 20 ? 1 : 0;

      // 2. æˆ°è¡“æŒ‡ä»¤èˆ‡è®Šè‰²
      let logicText = data.logic || "åˆ†æä¸­...";
      let logicEl = document.getElementById('logic-text');
      let card = document.getElementById('battle-card');

      logicEl.innerText = logicText;
      
      card.className = "battle-box"; // Reset
      if (bullR >= 55) {
          logicEl.style.color = "var(--red)";
          card.classList.add("glow-red");
      } else if (bullR <= 45) {
          logicEl.style.color = "var(--green)";
          card.classList.add("glow-green");
      } else {
          logicEl.style.color = "#aaa";
      }

      // 3. èˆŠç±Œç¢¼
      ['c1','c2','c3','c4'].forEach(id => {
        let raw = data[id]; if(!raw) return;
        let parts = raw.split('|');
        let v = parseFloat(parts[0].replace('%',''));
        let el = document.getElementById(id+'-val');
        el.innerText = parts[0]; el.className = "big-val " + (v>0?"c-red":(v<0?"c-green":"")); el.style.fontSize = "20px";
        let tag = document.getElementById(id+'-tag');
        tag.innerText = parts[1]; tag.className = "chip-tag " + (parts[1].includes("å¤š")?"bg-red":(parts[1].includes("ç©º")?"bg-green":""));
      });
    }
  </script>
</body>
</html>
